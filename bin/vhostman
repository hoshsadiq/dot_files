#!/usr/bin/env bash

function addVhost() {
	read -p "Please enter vhost domain name: " domain

	newconf=${VHOSTSCONFIG}/${domain}.conf

	[ -f $newconf ] && {
    	while [ -f $newconf ]; do
        	echo "This vhost already exists."
        	echo
			read -p "Please enter vhost domain name: " domain
        	newconf=${VHOSTSCONFIG}/${domain}.conf
    	done
    	exit 1
	}

	read -e -p "Please enter the root directory for this vhost: " rootdir

	[ ! -d $rootdir ] && {
    	while [ ! -d $rootdir ]; do
        	echo "This directory does not exist."
        	echo
			read -e -p "Please enter the root directory for this vhost: " rootdir
    	done
    	exit 1
	}

	command -v cygpath >/dev/null 2>&1 && rootdir=`echo $(cygpath -w $rootdir) | tr '\\\\' '\/'`

	echo "<VirtualHost \"${domain}:80\">" >> $newconf
	echo "    ServerAdmin postmaster@${domain}" >> $newconf
	echo "    DocumentRoot \"${rootdir}\"" >> $newconf
	echo "    ServerName ${domain}" >> $newconf
	echo "    ServerAlias www.${domain}" >> $newconf
	echo "    ErrorLog \"logs/${domain}-error.log\"" >> $newconf
	echo "    CustomLog \"logs/${domain}-access.log\" combined" >> $newconf
	echo "    <Directory \"${rootdir}\">" >> $newconf
	echo "		Options Indexes FollowSymLinks Includes ExecCGI" >> $newconf
	echo "	    AllowOverride All" >> $newconf
	echo "		Order allow,deny" >> $newconf
	echo "		Allow from all" >> $newconf
	echo "    </Directory>" >> $newconf
	echo "</VirtualHost>" >> $newconf

	echo
	echo "The new virtual host has been added. Now you need to restart Apache."
}

while [ true ]; do
	echo "[1] add virtual host"
	# echo "[2] delete virtual host"
	echo "[2] exit"
	read -p "Choose an option: " option

	case $option in
	1)
		addVhost
		;;
	# 2)
	# 	listVhosts
		# ;;
	*)
		exit 0
		;;
	esac
done

exit 0